<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Analytics Do not Remove-->
 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WTLWZMT5');</script>
<!-- End Google Tag Manager -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PQQ5LXLKWJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PQQ5LXLKWJ');
</script>
<!-- Primary Meta Tags -->
<title>PDFSmaller - Advanced PDF Compression with Optional Server Processing</title>
<meta name="title" content="PDFSmaller - Compress PDF Files with Client or Server Processing">
<meta name="description" content="Reduce PDF file size with privacy-first client-side compression or optional server processing for maximum compression. 100% free and secure.">
<meta name="keywords" content="compress pdf, reduce pdf size, pdf compressor, shrink pdf, pdf tool, privacy pdf compression, server pdf compression">
<meta name="author" content="PDFSmaller">
<meta name="robots" content="index, follow">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://pdfsmaller.site/">
<meta property="og:title" content="PDFSmaller - Advanced PDF Compression with Optional Server Processing">
<meta property="og:description" content="Choose between privacy-first client-side compression or optional server processing for maximum PDF compression. 100% free and secure.">
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='100%25' stop-color='%23764ba2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23grad)'/%3E%3Crect x='400' y='180' width='400' height='240' rx='15' fill='rgba(255,255,255,0.9)'/%3E%3Crect x='435' y='225' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Crect x='435' y='275' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Crect x='435' y='325' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Ccircle cx='700' cy='210' r='15' fill='%23e53e3e'/%3E%3Cpath d='M690 210 l5 -5 10 10' stroke='white' stroke-width='3' fill='none'/%3E%3Ctext x='600' y='120' font-family='Arial, sans-serif' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3EPDFSmaller%3C/text%3E%3Ctext x='600' y='170' font-family='Arial, sans-serif' font-size='30' text-anchor='middle' fill='white'%3EAdvanced PDF Compression%3C/text%3E%3Ctext x='600' y='220' font-family='Arial, sans-serif' font-size='24' text-anchor='middle' fill='white'%3EClient-Side • Optional Server Processing%3C/text%3E%3Ctext x='600' y='550' font-family='Arial, sans-serif' font-size='24' text-anchor='middle' fill='white'%3E100%25 Free • Privacy Focused%3C/text%3E%3C/svg%3E">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://pdfsmaller.site/">
<meta property="twitter:title" content="PDFSmaller - Advanced PDF Compression with Optional Server Processing">
<meta property="twitter:description" content="Choose between privacy-first client-side compression or optional server processing for maximum PDF compression. 100% free and secure.">
<meta property="twitter:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='100%25' stop-color='%23764ba2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23grad)'/%3E%3Crect x='400' y='180' width='400' height='240' rx='15' fill='rgba(255,255,255,0.9)'/%3E%3Crect x='435' y='225' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Crect x='435' y='275' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Crect x='435' y='325' width='330' height='30' rx='5' fill='%233182ce'/%3E%3Ccircle cx='700' cy='210' r='15' fill='%23e53e3e'/%3E%3Cpath d='M690 210 l5 -5 10 10' stroke='white' stroke-width='3' fill='none'/%3E%3Ctext x='600' y='120' font-family='Arial, sans-serif' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3EPDFSmaller%3C/text%3E%3Ctext x='600' y='170' font-family='Arial, sans-serif' font-size='30' text-anchor='middle' fill='white'%3EAdvanced PDF Compression%3C/text%3E%3Ctext x='600' y='220' font-family='Arial, sans-serif' font-size='24' text-anchor='middle' fill='white'%3EClient-Side • Optional Server Processing%3C/text%3E%3Ctext x='600' y='550' font-family='Arial, sans-serif' font-size='24' text-anchor='middle' fill='white'%3E100%25 Free • Privacy Focused%3C/text%3E%3C/svg%3E">

<!-- Google Search Console Intergration-->
 <meta name="google-site-verification" content="ylrJvKlQR-zxl56H7ovlzVGo_9vC941cbgl02yrSbwQ" />
<!-- Canonical URL -->
<link rel="canonical" href="https://pdfsmaller.site/">

<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%233182ce'/%3E%3Crect x='35' y='40' width='30' height='20' rx='2' fill='white'/%3E%3Cpath d='M40 45H60V50H40z M40 55H60V60H40z' fill='%233182ce'/%3E%3Ccircle cx='65' cy='40' r='4' fill='%23e53e3e'/%3E%3Cpath d='M62 40L65 37L68 40' stroke='white' stroke-width='1.5' fill='none'/%3E%3C/svg%3E">

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "PDFSmaller",
  "url": "https://pdfsmaller.site/",
  "description": "Reduce PDF file size with privacy-first client-side compression or optional server processing for maximum compression. 100% free and secure.",
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "features": ["Client-side processing", "Optional server processing", "No file uploads", "Privacy-focused"]
}
</script>

<!-- Javscript PDF Compression Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/compressorjs@1.1.1/dist/compressor.min.js"></script>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

:root {
    --primary: #3182ce;
    --primary-dark: #2c5282;
    --secondary: #e53e3e;
    --success: #38a169;
    --warning: #d69e2e;
    --premium: #9f7aea;
    --premium-dark: #805ad5;
    --gray-50: #f9fafb;
    --gray-100: #f7fafc;
    --gray-200: #edf2f7;
    --gray-300: #e2e8f0;
    --gray-400: #cbd5e0;
    --gray-500: #a0aec0;
    --gray-600: #718096;
    --gray-700: #4a5568;
    --gray-800: #2d3748;
    --gray-900: #1a202c;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--gray-800);
    min-height: 100vh;
    line-height: 1.6;
}

/* Header Styles */
.header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-lg);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo-container {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo {
    width: 40px;
    height: 40px;
}

.logo-text {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-menu {
    position: relative;
}

.user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.user-avatar:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--gray-200);
    min-width: 200px;
    z-index: 1000;
    transform: translateY(10px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
}

.user-dropdown.show {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
}

.dropdown-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid var(--gray-100);
}

.dropdown-item:last-child {
    border-bottom: none;
}

.dropdown-item:hover {
    background: var(--gray-50);
}

.plan-badge {
    background: var(--premium);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 12px;
    margin-left: 8px;
}

/* Main Content */
.main-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 20px;
}

/* Tab System */
.tab-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: var(--shadow-xl);
    overflow: hidden;
}

.tab-nav {
    display: flex;
    background: var(--gray-100);
    border-bottom: 1px solid var(--gray-200);
}

.tab-button {
    flex: 1;
    padding: 16px 24px;
    background: none;
    border: none;
    font-size: 1rem;
    font-weight: 600;
    color: var(--gray-600);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.tab-button:hover {
    color: var(--primary);
    background: rgba(49, 130, 206, 0.05);
}

.tab-button.active {
    color: var(--primary);
    background: white;
}

.tab-button.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary);
}

.tab-content {
    padding: 30px;
    min-height: 600px;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

/* Upload Areas */
.upload-area {
    border: 3px dashed var(--gray-300);
    border-radius: 15px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 25px;
    background: var(--gray-50);
}

.upload-area:hover {
    border-color: var(--primary);
    background: rgba(49, 130, 206, 0.05);
}

.upload-area.dragover {
    border-color: var(--primary);
    background: rgba(49, 130, 206, 0.1);
    transform: scale(1.02);
}

.bulk-upload-area {
    border: 3px dashed var(--premium);
    border-radius: 15px;
    padding: 60px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 25px;
    background: linear-gradient(135deg, rgba(159, 122, 234, 0.05), rgba(128, 90, 213, 0.05));
    position: relative;
}

.bulk-upload-area::before {
    content: 'PRO';
    position: absolute;
    top: 15px;
    right: 15px;
    background: var(--premium);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
}

.upload-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 20px;
}

.upload-text {
    font-size: 1.3rem;
    color: var(--gray-800);
    margin-bottom: 10px;
    font-weight: 600;
}

.upload-subtext {
    color: var(--gray-600);
    font-size: 1rem;
}

.file-input {
    display: none;
}

/* File Info */
.file-info {
    display: none;
    align-items: center;
    gap: 15px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
}

.file-icon {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
}

.file-details h4 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 4px;
}

.file-details p {
    color: var(--gray-600);
    font-size: 0.9rem;
}

/* Bulk File List */
.bulk-file-list {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid var(--gray-200);
    display: none;
}

.bulk-file-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    border-bottom: 1px solid var(--gray-100);
    transition: background-color 0.2s ease;
}

.bulk-file-item:last-child {
    border-bottom: none;
}

.bulk-file-item:hover {
    background: var(--gray-50);
}

.remove-file-btn {
    background: var(--secondary);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.remove-file-btn:hover {
    background: #c53030;
    transform: translateY(-1px);
}

/* Compression Options */
.compression-options {
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.compression-options h3 {
    font-size: 1.2rem;
    margin-bottom: 20px;
    color: var(--gray-800);
}

.option-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.option-group {
    display: flex;
    flex-direction: column;
}

.option-group label {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 8px;
}

.option-group select,
.option-group input[type="range"] {
    padding: 10px;
    border: 2px solid var(--gray-300);
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.2s ease;
    background: white;
}

.option-group select:focus,
.option-group input[type="range"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
}

.range-container {
    position: relative;
}

.range-value {
    position: absolute;
    top: -30px;
    right: 0;
    background: var(--primary);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.processing-mode {
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
}

.processing-mode label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    margin-bottom: 0;
}

.processing-info {
    margin-top: 10px;
    font-size: 0.85rem;
    color: var(--gray-600);
    display: none;
}

.processing-info.show {
    display: block;
}

/* Buttons */
.btn {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn.processing {
    animation: pulse 1.5s infinite;
}

.btn-premium {
    background: linear-gradient(135deg, var(--premium), var(--premium-dark));
}

.btn-secondary {
    background: linear-gradient(135deg, var(--gray-600), var(--gray-700));
}

.btn-success {
    background: linear-gradient(135deg, var(--success), #2f855a);
}

.btn-large {
    padding: 16px 32px;
    font-size: 1.1rem;
    width: 100%;
    margin: 20px 0;
}

/* Progress Bars */
.progress-container {
    margin: 25px 0;
    display: none;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--gray-700);
}

.progress-bar-container {
    width: 100%;
    height: 8px;
    background: var(--gray-200);
    border-radius: 4px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 4px;
}

/* Results */
.results-container {
    display: none;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.result-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-200);
}

.result-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 8px;
}

.result-label {
    color: var(--gray-600);
    font-size: 0.9rem;
}

/* Modals */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.modal-overlay.show {
    opacity: 1;
    visibility: visible;
}

.modal {
    background: white;
    border-radius: 16px;
    padding: 40px;
    max-width: 400px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-xl);
    transform: translateY(20px);
    transition: transform 0.3s ease;
}

.modal-overlay.show .modal {
    transform: translateY(0);
}

.modal h2 {
    text-align: center;
    margin-bottom: 30px;
    color: var(--gray-800);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: var(--gray-700);
}

.form-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--gray-300);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
}

.form-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
}

.modal-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.modal-actions .btn {
    flex: 1;
}

.auth-switch {
    text-align: center;
    margin-top: 20px;
    color: var(--gray-600);
}

.auth-switch a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
}

.auth-switch a:hover {
    text-decoration: underline;
}

/* Notifications */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 20px;
    border-radius: 8px;
    background: white;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    max-width: 400px;
    border-left: 4px solid var(--success);
}

.notification.show {
    transform: translateX(0);
}

.notification.error {
    border-left-color: var(--secondary);
}

.notification.warning {
    border-left-color: var(--warning);
}

.notification-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

/* Utility Classes */
.hidden { display: none !important; }
.flex { display: flex; }
.flex-column { flex-direction: column; }
.justify-center { justify-content: center; }
.justify-between { justify-content: space-between; }
.align-center { align-items: center; }
.text-center { text-align: center; }
.gap-2 { gap: 8px; }
.gap-3 { gap: 12px; }
.mt-4 { margin-top: 16px; }
.mb-4 { margin-bottom: 16px; }

/* Animations */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        padding: 12px 16px;
    }
    
    .main-content {
        padding: 20px 16px;
    }
    
    .tab-nav {
        flex-direction: column;
    }
    
    .tab-content {
        padding: 20px;
    }
    
    .option-grid {
        grid-template-columns: 1fr;
    }
    
    .modal {
        padding: 30px 20px;
    }
    
    .modal-actions {
        flex-direction: column;
    }
}

/* New styles for pricing section */
.pricing-container {
    padding: 30px;
    max-width: 1200px;
    margin: 0 auto;
}

.pricing-header {
    text-align: center;
    margin-bottom: 40px;
}

.pricing-header h2 {
    font-size: 2.5rem;
    color: var(--gray-800);
    margin-bottom: 16px;
}

.pricing-header p {
    font-size: 1.2rem;
    color: var(--gray-600);
    max-width: 600px;
    margin: 0 auto;
}

.pricing-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
}

.pricing-card {
    background: white;
    border-radius: 16px;
    padding: 40px 30px;
    box-shadow: var(--shadow-lg);
    text-align: center;
    transition: all 0.3s ease;
    border: 2px solid var(--gray-200);
    position: relative;
    overflow: hidden;
}

.pricing-card.featured {
    border-color: var(--premium);
    transform: scale(1.05);
}

.pricing-card.featured::before {
    content: 'MOST POPULAR';
    position: absolute;
    top: 0;
    right: 0;
    background: var(--premium);
    color: white;
    padding: 8px 16px;
    font-size: 0.75rem;
    font-weight: 700;
    border-bottom-left-radius: 8px;
}

.pricing-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
}

.pricing-card.featured:hover {
    transform: scale(1.05) translateY(-5px);
}

.plan-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 16px;
}

.plan-price {
    font-size: 3rem;
    font-weight: 800;
    color: var(--premium);
    margin-bottom: 8px;
}

.plan-price .currency {
    font-size: 1.5rem;
    vertical-align: super;
}

.plan-price .period {
    font-size: 1rem;
    font-weight: 400;
    color: var(--gray-600);
}

.plan-description {
    color: var(--gray-600);
    margin-bottom: 30px;
    min-height: 60px;
}

.plan-features {
    list-style: none;
    margin-bottom: 30px;
    text-align: left;
}

.plan-features li {
    padding: 10px 0;
    border-bottom: 1px solid var(--gray-100);
    display: flex;
    align-items: center;
}

.plan-features li:last-child {
    border-bottom: none;
}

.feature-icon {
    width: 20px;
    height: 20px;
    margin-right: 12px;
    color: var(--success);
}

.plan-cta {
    margin-top: auto;
}

.current-plan-badge {
    background: var(--success);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    margin-top: 16px;
    display: inline-block;
}

.faq-section {
    margin-top: 80px;
    padding: 40px 0;
    background: var(--gray-50);
    border-radius: 16px;
}

.faq-title {
    text-align: center;
    margin-bottom: 40px;
    font-size: 2rem;
    color: var(--gray-800);
}

.faq-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
}

.faq-item {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--shadow);
}

.faq-question {
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 12px;
    font-size: 1.1rem;
}

.faq-answer {
    color: var(--gray-600);
    line-height: 1.6;
}

/* Responsive adjustments for pricing */
@media (max-width: 768px) {
    .pricing-grid {
        grid-template-columns: 1fr;
    }
    
    .pricing-card.featured {
        transform: none;
    }
    
    .pricing-card.featured:hover {
        transform: translateY(-5px);
    }
    
    .pricing-header h2 {
        font-size: 2rem;
    }
    
    .pricing-header p {
        font-size: 1rem;
    }
}

</style>
</head>

<body>
<header class="header">
    <div class="header-content">
        <div class="logo-container">
            <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <rect x="20" y="25" width="60" height="50" rx="5" fill="#3182ce"/>
                <path d="M35 40H65V45H35z M35 50H65V55H35z M35 60H65V65H35z" fill="white"/>
                <circle cx="75" cy="35" r="5" fill="#e53e3e"/>
                <path d="M70 35L75 30L80 35" stroke="white" stroke-width="2" fill="none"/>
            </svg>
            <a href="#" class="logo-text">PDFSmaller Pro</a>
        </div>
        
        <div class="nav-actions">
            <div id="guestActions" class="flex gap-3">
                <button class="btn" onclick="showAuthModal('login')">Sign In</button>
                <button class="btn btn-premium" onclick="switchTab('pricing')">Get Pro</button>
            </div>
            
            <div id="userActions" class="user-menu hidden">
                <div class="user-avatar" onclick="toggleUserDropdown()">
                    <span id="userInitials">U</span>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-item">
                        <strong id="userName">User</strong>
                        <span id="userPlan" class="plan-badge">Free</span>
                    </div>
                    <div class="dropdown-item" onclick="switchTab('pricing')">
                        <span>Upgrade Plan</span>
                    </div>
                    <div class="dropdown-item" onclick="logout()">
                        <span>Sign Out</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="main-content">
    <div class="tab-container">
        <nav class="tab-nav">
            <button class="tab-button active" onclick="switchTab('single')">Single PDF</button>
            <button class="tab-button" onclick="switchTab('bulk')">Bulk Processing</button>
            <button class="tab-button" onclick="switchTab('pricing')">Pricing</button>
        </nav>
        
        <div class="tab-content">
            <!-- Single PDF Compression -->
            <div id="singleTab" class="tab-panel active">
                <h2>Compress Single PDF</h2>
                
                <div class="upload-area" id="singleUploadArea">
                    <svg class="upload-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="40" fill="#4a5568" opacity="0.1"/>
                        <path d="M50 35V65M35 50H65" stroke="#667eea" stroke-width="8" stroke-linecap="round"/>
                        <rect x="30" y="25" width="40" height="30" rx="3" fill="#667eea" opacity="0.2"/>
                        <path d="M40 35H60V40H40z M40 45H60V50H40z" fill="#667eea"/>
                    </svg>
                    <div class="upload-text">Drop your PDF here or click to browse</div>
                    <div class="upload-subtext">Maximum file size: 50MB</div>
                </div>
                <input type="file" id="singleFileInput" class="file-input" accept=".pdf" />
                
                <div id="singleFileInfo" class="file-info">
                    <svg class="file-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect x="25" y="25" width="50" height="50" rx="5" fill="#3182ce"/>
                        <path d="M35 40H65V45H35z M35 50H65V55H35z M35 60H65V65H35z" fill="white"/>
                    </svg>
                    <div class="file-details">
                        <h4 id="singleFileName"></h4>
                        <p id="singleFileSize"></p>
                    </div>
                </div>

                <div class="compression-options">
                    <h3>Compression Settings</h3>
                    <div class="option-grid">
                        <div class="option-group">
                            <label for="singleCompressionLevel">Compression Level:</label>
                            <select id="singleCompressionLevel">
                                <option value="low">Low (Better Quality)</option>
                                <option value="medium" selected>Medium (Balanced)</option>
                                <option value="high">High (Smaller Size)</option>
                                <option value="maximum">Maximum (Smallest Size)</option>
                            </select>
                        </div>
                        
                        <div class="option-group">
                            <label for="singleImageQuality">Image Quality:</label>
                            <div class="range-container">
                                <input type="range" id="singleImageQuality" min="10" max="100" value="70">
                                <div class="range-value" id="singleQualityValue">70%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="processingModeContainer" class="processing-mode">
                        <label>
                            <input type="checkbox" id="useServerProcessing"> 
                            Use Server Processing (Pro Feature)
                        </label>
                        <div id="serverProcessingInfo" class="processing-info">
                            Advanced server-side compression with better algorithms and image optimization.
                        </div>
                    </div>
                </div>

                <button id="singleCompressBtn" class="btn btn-large" disabled>
                    <span>Compress PDF</span>
                </button>

                <div id="singleProgress" class="progress-container">
                    <div class="progress-label">
                        <span>Processing</span>
                        <span id="singleProgressPercentage">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="singleProgressBar"></div>
                    </div>
                </div>

                <div id="singleResults" class="results-container">
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value" id="singleOriginalSize">0 KB</div>
                            <div class="result-label">Original Size</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="singleCompressedSize">0 KB</div>
                            <div class="result-label">Compressed Size</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="singleReductionPercent">0%</div>
                            <div class="result-label">Size Reduction</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="singleProcessingTime">0s</div>
                            <div class="result-label">Processing Time</div>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button id="singleDownloadBtn" class="btn btn-success flex-1">Download Compressed PDF</button>
                        <button id="singleNewFileBtn" class="btn btn-secondary flex-1">Process Another</button>
                    </div>
                </div>
            </div>

            <!-- Bulk Processing -->
            <div id="bulkTab" class="tab-panel">
                <h2>Bulk PDF Compression</h2>
                
                <div id="bulkUpgradePrompt" class="text-center mb-4">
                    <h3 style="color: var(--premium);">Bulk Processing - Pro Feature</h3>
                    <p>Upload multiple PDFs and compress them all at once with advanced server-side processing.</p>
                    <button class="btn btn-premium mt-4" onclick="showAuthModal('register')">Upgrade to Pro</button>
                </div>

                <div id="bulkProcessingArea" class="hidden">
                    <div class="bulk-upload-area" id="bulkUploadArea">
                        <svg class="upload-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="#9f7aea" opacity="0.1"/>
                            <path d="M50 35V65M35 50H65" stroke="#9f7aea" stroke-width="8" stroke-linecap="round"/>
                            <rect x="25" y="20" width="35" height="25" rx="3" fill="#9f7aea" opacity="0.3"/>
                            <rect x="40" y="35" width="35" height="25" rx="3" fill="#9f7aea" opacity="0.2"/>
                        </svg>
                        <div class="upload-text">Drop multiple PDFs here or click to browse</div>
                        <div class="upload-subtext">Maximum 100 files, 10MB each</div>
                    </div>
                    <input type="file" id="bulkFileInput" class="file-input" accept=".pdf" multiple />

                    <div id="bulkFileList" class="bulk-file-list"></div>

                    <div class="compression-options">
                        <h3>Bulk Compression Settings</h3>
                        <div class="option-grid">
                            <div class="option-group">
                                <label for="bulkCompressionLevel">Compression Level:</label>
                                <select id="bulkCompressionLevel">
                                    <option value="low">Low (Better Quality)</option>
                                    <option value="medium" selected>Medium (Balanced)</option>
                                    <option value="high">High (Smaller Size)</option>
                                    <option value="maximum">Maximum (Smallest Size)</option>
                                    <option value="extreme">Extreme (Pro Only)</option>
                                </select>
                            </div>
                            
                            <div class="option-group">
                                <label for="bulkImageQuality">Image Quality:</label>
                                <div class="range-container">
                                    <input type="range" id="bulkImageQuality" min="10" max="100" value="60">
                                    <div class="range-value" id="bulkQualityValue">60%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="bulkCompressBtn" class="btn btn-premium btn-large" disabled>
                        <span>Compress All Files</span>
                    </button>

                    <div id="bulkProgress" class="progress-container">
                        <div class="progress-label">
                            <span id="bulkProgressText">Processing</span>
                            <span id="bulkProgressPercentage">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="bulkProgressBar"></div>
                        </div>
                    </div>

                    <div id="bulkResults" class="results-container">
                        <div class="results-grid">
                            <div class="result-card">
                                <div class="result-value" id="bulkTotalFiles">0</div>
                                <div class="result-label">Files Processed</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="bulkTotalSavings">0 MB</div>
                                <div class="result-label">Total Space Saved</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="bulkAverageReduction">0%</div>
                                <div class="result-label">Average Reduction</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="bulkTotalTime">0s</div>
                                <div class="result-label">Total Processing Time</div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button id="bulkDownloadBtn" class="btn btn-success flex-1">Download All (ZIP)</button>
                            <button id="bulkNewBatchBtn" class="btn btn-secondary flex-1">Process New Batch</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pricing Section -->
            <div id="pricingTab" class="tab-panel">
                <div class="pricing-container">
                    <div class="pricing-header">
                        <h2>Choose Your Plan</h2>
                        <p>Select the plan that works best for your PDF compression needs. All plans include our core features with additional benefits for Pro users.</p>
                    </div>

                    <div class="pricing-grid">
                        <!-- Free Plan -->
                        <div class="pricing-card">
                            <div class="plan-name">Free</div>
                            <div class="plan-price">
                                <span class="currency">$</span>0
                                <span class="period">/ forever</span>
                            </div>
                            <div class="plan-description">Perfect for occasional users with basic needs</div>
                            
                            <ul class="plan-features">
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Single file processing</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> 50MB file size limit</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Basic compression</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Client-side processing</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> No bulk processing</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> No server processing</li>
                            </ul>
                            
                            <div class="plan-cta">
                                <button class="btn btn-secondary" onclick="handlePlanSelection('free')" id="freePlanBtn">
                                    Current Plan
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pro Monthly Plan -->
                        <div class="pricing-card featured">
                            <div class="plan-name">Pro Monthly</div>
                            <div class="plan-price">
                                <span class="currency">$</span>9
                                <span class="period">/ month</span>
                            </div>
                            <div class="plan-description">Ideal for regular users who need advanced features</div>
                            
                            <ul class="plan-features">
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Everything in Free</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Bulk file processing</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> 100MB file size limit</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Server-side processing</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Advanced compression</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Priority support</li>
                            </ul>
                            
                            <div class="plan-cta">
                                <button class="btn btn-premium" onclick="handlePlanSelection('pro_monthly')" id="proMonthlyBtn">
                                    Upgrade Now
                                </button>
                                <div id="proMonthlyCurrent" class="current-plan-badge hidden">Current Plan</div>
                            </div>
                        </div>
                        
                        <!-- Pro Annual Plan -->
                        <div class="pricing-card">
                            <div class="plan-name">Pro Annual</div>
                            <div class="plan-price">
                                <span class="currency">$</span>90
                                <span class="period">/ year</span>
                            </div>
                            <div class="plan-description">Best value - save 17% compared to monthly billing</div>
                            
                            <ul class="plan-features">
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Everything in Pro Monthly</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> 17% savings</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> 200MB file size limit</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Extreme compression level</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Dedicated support</li>
                                <li><svg class="feature-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Early access to new features</li>
                            </ul>
                            
                            <div class="plan-cta">
                                <button class="btn btn-premium" onclick="handlePlanSelection('pro_annual')" id="proAnnualBtn">
                                    Upgrade Now
                                </button>
                                <div id="proAnnualCurrent" class="current-plan-badge hidden">Current Plan</div>
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h3 class="faq-title">Frequently Asked Questions</h3>
                        <div class="faq-grid">
                            <div class="faq-item">
                                <div class="faq-question">Can I change my plan later?</div>
                                <div class="faq-answer">Yes, you can upgrade or downgrade your plan at any time. When upgrading, you'll get immediate access to the new features. When downgrading, the changes will take effect at the end of your billing cycle.</div>
                            </div>
                            <div class="faq-item">
                                <div class="faq-question">Is there a free trial?</div>
                                <div class="faq-answer">We don't offer a free trial for our Pro plans, but you can use our Free plan indefinitely to test our basic features. All Pro plans come with a 14-day money-back guarantee.</div>
                            </div>
                            <div class="faq-item">
                                <div class="faq-question">What payment methods do you accept?</div>
                                <div class="faq-answer">We accept all major credit cards, PayPal, and in some regions, bank transfers. All payments are processed securely through our payment partners.</div>
                            </div>
                            <div class="faq-item">
                                <div class="faq-question">How does the bulk processing work?</div>
                                <div class="faq-answer">Our bulk processing allows you to upload multiple PDF files at once (up to 100 files). The system will process them sequentially and provide you with a ZIP download containing all compressed files.</div>
                            </div>
                            <div class="faq-item">
                                <div class="faq-question">Can I cancel my subscription?</div>
                                <div class="faq-answer">Yes, you can cancel your subscription at any time. You'll continue to have access to Pro features until the end of your billing period, after which your account will revert to the Free plan.</div>
                            </div>
                            <div class="faq-item">
                                <div class="faq-question">Is my data secure?</div>
                                <div class="faq-answer">Absolutely. We use industry-standard encryption for all file transfers and processing. Your files are automatically deleted from our servers after 24 hours, and we never share your data with third parties.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            
        </div>
    </div>
</main>

<!-- Auth Modal -->
<div id="authModal" class="modal-overlay">
    <div class="modal">
        <h2 id="authModalTitle">Sign In</h2>
        <form id="authForm">
            <div class="form-group">
                <label for="authEmail">Email</label>
                <input type="email" id="authEmail" required>
            </div>
            <div class="form-group">
                <label for="authPassword">Password</label>
                <input type="password" id="authPassword" required>
            </div>
            <div id="authNameGroup" class="form-group hidden">
                <label for="authName">Full Name</label>
                <input type="text" id="authName">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideAuthModal()">Cancel</button>
                <button type="submit" class="btn" id="authSubmitBtn">Sign In</button>
            </div>
        </form>
        <div class="auth-switch">
            <span id="authSwitchText">Don't have an account?</span>
            <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Sign up</a>
        </div>
    </div>
</div>

<script>
// Application State Management
class AppState {
    constructor() {
        this.user = null;
        this.currentTab = 'single';
        this.singleFile = null;
        this.bulkFiles = [];
        this.isProcessing = false;
        this.compressedBlob = null;
        this.bulkCompressedFiles = [];
    }

    reset() {
        this.singleFile = null;
        this.bulkFiles = [];
        this.compressedBlob = null;
        this.bulkCompressedFiles = [];
        this.isProcessing = false;
    }
}

// Authentication System
class AuthenticationManager {
    constructor(appState) {
        this.appState = appState;
        this.init();
    }

    init() {
        // Check for existing user session
        const userData = localStorage.getItem('pdfsmaller_user');
        if (userData) {
            try {
                this.appState.user = JSON.parse(userData);
                this.updateUI();
            } catch (e) {
                localStorage.removeItem('pdfsmaller_user');
            }
        }
    }

    async login(email, password) {
        // Simulate API call with demo credentials
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if (email === 'demo@example.com' && password === 'password') {
                    const user = {
                        id: 1,
                        name: 'Demo User',
                        email: email,
                        plan: 'Free'
                    };
                    this.setUser(user);
                    resolve(user);
                } else if (email === 'pro@example.com' && password === 'password') {
                    const user = {
                        id: 2,
                        name: 'Pro User',
                        email: email,
                        plan: 'Pro'
                    };
                    this.setUser(user);
                    resolve(user);
                } else {
                    reject(new Error('Invalid credentials. Try: demo@example.com / password or pro@example.com / password'));
                }
            }, 1000);
        });
    }

    async register(email, password, name) {
        // Simulate registration
        return new Promise((resolve) => {
            setTimeout(() => {
                const user = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    plan: 'Free'
                };
                this.setUser(user);
                resolve(user);
            }, 1000);
        });
    }

    setUser(user) {
        this.appState.user = user;
        localStorage.setItem('pdfsmaller_user', JSON.stringify(user));
        this.updateUI();
    }

    logout() {
        this.appState.user = null;
        localStorage.removeItem('pdfsmaller_user');
        this.updateUI();
        showNotification('Signed out successfully', 'success');
    }

    updateUI() {
        const guestActions = document.getElementById('guestActions');
        const userActions = document.getElementById('userActions');
        const bulkUpgradePrompt = document.getElementById('bulkUpgradePrompt');
        const bulkProcessingArea = document.getElementById('bulkProcessingArea');
        const useServerCheckbox = document.getElementById('useServerProcessing');

        if (this.appState.user) {
            guestActions.classList.add('hidden');
            userActions.classList.remove('hidden');
            
            document.getElementById('userInitials').textContent = 
                this.appState.user.name.charAt(0).toUpperCase();
            document.getElementById('userName').textContent = this.appState.user.name;
            document.getElementById('userPlan').textContent = this.appState.user.plan;

            // Enable/disable features based on plan
            if (this.appState.user.plan === 'Pro') {
                bulkUpgradePrompt.classList.add('hidden');
                bulkProcessingArea.classList.remove('hidden');
                useServerCheckbox.disabled = false;
            } else {
                bulkUpgradePrompt.classList.remove('hidden');
                bulkProcessingArea.classList.add('hidden');
                useServerCheckbox.disabled = true;
            }
        } else {
            guestActions.classList.remove('hidden');
            userActions.classList.add('hidden');
            bulkUpgradePrompt.classList.remove('hidden');
            bulkProcessingArea.classList.add('hidden');
            useServerCheckbox.disabled = true;
        }
    }

    isPro() {
        return this.appState.user && this.appState.user.plan === 'Pro';
    }
}

// PDF Compression Engine
class PDFCompressor {
    constructor(appState) {
        this.appState = appState;
    }

    async compressSingle(file, options) {
        const startTime = Date.now();
        
        try {
            let compressedBlob;
            
            if (options.useServer && auth.isPro()) {
                compressedBlob = await this.compressOnServer(file, options);
            } else {
                compressedBlob = await this.compressClientSide(file, options);
            }
            
            const endTime = Date.now();
            const processingTime = (endTime - startTime) / 1000;
            
            return {
                originalSize: file.size,
                compressedSize: compressedBlob.size,
                processingTime: processingTime,
                blob: compressedBlob
            };
        } catch (error) {
            throw new Error(`Compression failed: ${error.message}`);
        }
    }

    async compressClientSide(file, options) {
        updateSingleProgress(20, 'Loading PDF...');
        
        const arrayBuffer = await file.arrayBuffer();
        updateSingleProgress(40, 'Processing...');
        
        // Load PDF with PDF-lib
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        updateSingleProgress(60, 'Compressing...');
        
        // Configure compression options
        const compressionOptions = this.getClientCompressionOptions(options);
        
        updateSingleProgress(80, 'Finalizing...');
        
        // Save compressed PDF
        const compressedBytes = await pdfDoc.save(compressionOptions);
        updateSingleProgress(100, 'Complete!');
        
        return new Blob([compressedBytes], { type: 'application/pdf' });
    }

    async compressOnServer(file, options) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('compressionLevel', options.compressionLevel);
        formData.append('imageQuality', options.imageQuality);
        formData.append('userId', this.appState.user?.id || 'anonymous');

        // Simulate server compression with better results
        return new Promise((resolve) => {
            let progress = 20;
            const interval = setInterval(() => {
                progress += 15;
                updateSingleProgress(Math.min(progress, 90), 'Server processing...');
                
                if (progress >= 90) {
                    clearInterval(interval);
                    
                    // Simulate server response with better compression
                    setTimeout(() => {
                        updateSingleProgress(100, 'Complete!');
                        
                        // Create a more compressed version for server processing
                        const reductionFactor = this.getServerReductionFactor(options);
                        const compressedSize = Math.floor(file.size * reductionFactor);
                        
                        // Create dummy compressed blob (in real app, this would be from server)
                        const compressedBlob = new Blob(
                            [new ArrayBuffer(compressedSize)], 
                            { type: 'application/pdf' }
                        );
                        
                        resolve(compressedBlob);
                    }, 500);
                }
            }, 300);
        });
    }

    async compressBulk(files, options) {
        if (!auth.isPro()) {
            throw new Error('Bulk processing requires Pro subscription');
        }

        const startTime = Date.now();
        const results = [];
        
        updateBulkProgress(0, 'Starting bulk compression...');

        // Process files in batches for better performance
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const progress = ((i + 1) / files.length) * 100;
            
            updateBulkProgress(progress, `Processing ${i + 1}/${files.length}: ${file.name}`);
            
            try {
                const result = await this.compressOnServer(file, options);
                results.push({
                    originalName: file.name,
                    originalSize: file.size,
                    compressedSize: result.size,
                    blob: result
                });
            } catch (error) {
                console.error(`Failed to compress ${file.name}:`, error);
                // Continue with other files
            }
            
            // Small delay to prevent UI blocking
            await new Promise(resolve => setTimeout(resolve, 100));
        }

        const endTime = Date.now();
        const totalProcessingTime = (endTime - startTime) / 1000;

        return {
            files: results,
            totalProcessingTime: totalProcessingTime
        };
    }

    getClientCompressionOptions(options) {
        const baseOptions = {
            useObjectStreams: true,
            addDefaultPage: false,
            objectsPerTick: 50
        };

        switch (options.compressionLevel) {
            case 'low':
                return { ...baseOptions, useObjectStreams: false };
            case 'medium':
                return baseOptions;
            case 'high':
                return { ...baseOptions, objectsPerTick: 100 };
            case 'maximum':
                return { ...baseOptions, useObjectStreams: false, objectsPerTick: 200 };
            default:
                return baseOptions;
        }
    }

    getServerReductionFactor(options) {
        // Server processing achieves better compression ratios
        const baseReduction = {
            'low': 0.85,
            'medium': 0.65,
            'high': 0.45,
            'maximum': 0.35,
            'extreme': 0.25
        };

        const qualityFactor = options.imageQuality / 100;
        return baseReduction[options.compressionLevel] * (0.7 + qualityFactor * 0.3);
    }
}

// UI Management Functions

function switchTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
    
    // Update tab panels
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    document.getElementById(`${tabName}Tab`).classList.add('active');
    
    appState.currentTab = tabName;
    
    // If switching to pricing tab, update the UI based on current plan
    if (tabName === 'pricing') {
        updatePricingUI();
    }
}

// Function to update pricing UI based on current user plan
function updatePricingUI() {
    const user = appState.user;
    const freePlanBtn = document.getElementById('freePlanBtn');
    const proMonthlyBtn = document.getElementById('proMonthlyBtn');
    const proAnnualBtn = document.getElementById('proAnnualBtn');
    const proMonthlyCurrent = document.getElementById('proMonthlyCurrent');
    const proAnnualCurrent = document.getElementById('proAnnualCurrent');
    
    // Reset all buttons
    freePlanBtn.textContent = 'Current Plan';
    freePlanBtn.classList.remove('btn-premium');
    freePlanBtn.classList.add('btn-secondary');
    freePlanBtn.disabled = true;
    
    proMonthlyBtn.textContent = 'Upgrade Now';
    proMonthlyBtn.classList.remove('btn-secondary');
    proMonthlyBtn.classList.add('btn-premium');
    proMonthlyBtn.disabled = false;
    
    proAnnualBtn.textContent = 'Upgrade Now';
    proAnnualBtn.classList.remove('btn-secondary');
    proAnnualBtn.classList.add('btn-premium');
    proAnnualBtn.disabled = false;
    
    // Hide all current plan badges
    proMonthlyCurrent.classList.add('hidden');
    proAnnualCurrent.classList.add('hidden');
    
    // Update based on current plan
    if (user) {
        if (user.plan === 'Free') {
            freePlanBtn.textContent = 'Current Plan';
            freePlanBtn.disabled = true;
        } else if (user.plan === 'Pro' || user.plan === 'Pro Monthly') {
            freePlanBtn.textContent = 'Downgrade';
            freePlanBtn.disabled = false;
            freePlanBtn.onclick = () => downgradeToFree();
            
            proMonthlyBtn.textContent = 'Current Plan';
            proMonthlyBtn.classList.remove('btn-premium');
            proMonthlyBtn.classList.add('btn-secondary');
            proMonthlyBtn.disabled = true;
            proMonthlyCurrent.classList.remove('hidden');
        } else if (user.plan === 'Pro Annual') {
            freePlanBtn.textContent = 'Downgrade';
            freePlanBtn.disabled = false;
            freePlanBtn.onclick = () => downgradeToFree();
            
            proAnnualBtn.textContent = 'Current Plan';
            proAnnualBtn.classList.remove('btn-premium');
            proAnnualBtn.classList.add('btn-secondary');
            proAnnualBtn.disabled = true;
            proAnnualCurrent.classList.remove('hidden');
        }
    } else {
        // User is not logged in
        freePlanBtn.textContent = 'Get Started';
        freePlanBtn.disabled = false;
        freePlanBtn.onclick = () => showAuthModal('register');
    }
}

// Function to handle plan selection
function handlePlanSelection(plan) {
    if (!appState.user) {
        // If user is not logged in, show auth modal with register form
        showAuthModal('register');
        return;
    }
    
    // Check if user is already on this plan
    if ((plan === 'free' && appState.user.plan === 'Free') ||
        (plan === 'pro_monthly' && (appState.user.plan === 'Pro' || appState.user.plan === 'Pro Monthly')) ||
        (plan === 'pro_annual' && appState.user.plan === 'Pro Annual')) {
        showNotification('You are already on this plan', 'info');
        return;
    }
    
    // Handle upgrade/downgrade
    if (plan === 'free') {
        downgradeToFree();
    } else {
        upgradeToPro(plan);
    }
}

// Function to upgrade to Pro plan
async function upgradeToPro(plan) {
    try {
        showNotification('Processing your upgrade...', 'info');
        
        // Call backend API to create subscription
        const planId = plan === 'pro_monthly' ? 'price_monthly' : 'price_annual';
        const paymentMethod = 'card'; // In a real implementation, this would come from a payment form
        
        const response = await backendAPI.createSubscription(planId, paymentMethod);
        
        // Update user plan
        appState.user.plan = plan === 'pro_monthly' ? 'Pro Monthly' : 'Pro Annual';
        localStorage.setItem('pdfsmaller_user', JSON.stringify(appState.user));
        
        // Update UI
        auth.updateUI();
        updatePricingUI();
        
        showNotification('Successfully upgraded to Pro!', 'success');
    } catch (error) {
        console.error('Upgrade failed:', error);
        showNotification('Upgrade failed: ' + error.message, 'error');
    }
}

// Function to downgrade to Free plan
async function downgradeToFree() {
    try {
        showNotification('Processing your downgrade...', 'info');
        
        // Call backend API to cancel subscription
        await backendAPI.cancelSubscription();
        
        // Update user plan
        appState.user.plan = 'Free';
        localStorage.setItem('pdfsmaller_user', JSON.stringify(appState.user));
        
        // Update UI
        auth.updateUI();
        updatePricingUI();
        
        showNotification('Your plan has been changed to Free. Pro features will be available until the end of your billing period.', 'success');
    } catch (error) {
        console.error('Downgrade failed:', error);
        showNotification('Downgrade failed: ' + error.message, 'error');
    }
}


function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateSingleProgress(percent, text = 'Processing') {
    const progressContainer = document.getElementById('singleProgress');
    const progressBar = document.getElementById('singleProgressBar');
    const progressPercentage = document.getElementById('singleProgressPercentage');
    const progressLabel = progressContainer.querySelector('.progress-label span');
    
    progressContainer.style.display = 'block';
    progressBar.style.width = percent + '%';
    progressPercentage.textContent = percent + '%';
    progressLabel.textContent = text;
}

function updateBulkProgress(percent, text = 'Processing') {
    const progressContainer = document.getElementById('bulkProgress');
    const progressBar = document.getElementById('bulkProgressBar');
    const progressPercentage = document.getElementById('bulkProgressPercentage');
    const progressText = document.getElementById('bulkProgressText');
    
    progressContainer.style.display = 'block';
    progressBar.style.width = percent + '%';
    progressPercentage.textContent = Math.round(percent) + '%';
    progressText.textContent = text;
}

function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : 'ℹ';
    notification.innerHTML = `
        <div class="notification-icon">${icon}</div>
        <span>${message}</span>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 10);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 4000);
}

// Modal Functions
function showAuthModal(mode) {
    const modal = document.getElementById('authModal');
    const title = document.getElementById('authModalTitle');
    const submitBtn = document.getElementById('authSubmitBtn');
    const nameGroup = document.getElementById('authNameGroup');
    const switchText = document.getElementById('authSwitchText');
    const switchLink = document.getElementById('authSwitchLink');
    
    if (mode === 'login') {
        title.textContent = 'Sign In';
        submitBtn.textContent = 'Sign In';
        nameGroup.classList.add('hidden');
        switchText.textContent = "Don't have an account?";
        switchLink.textContent = 'Sign up';
    } else {
        title.textContent = 'Create Account';
        submitBtn.textContent = 'Create Account';
        nameGroup.classList.remove('hidden');
        switchText.textContent = "Already have an account?";
        switchLink.textContent = 'Sign in';
    }
    
    modal.classList.add('show');
}

function hideAuthModal() {
    document.getElementById('authModal').classList.remove('show');
    document.getElementById('authForm').reset();
}

function toggleAuthMode() {
    const title = document.getElementById('authModalTitle');
    const isLogin = title.textContent === 'Sign In';
    showAuthModal(isLogin ? 'register' : 'login');
}

function toggleUserDropdown() {
    document.getElementById('userDropdown').classList.toggle('show');
}

function logout() {
    auth.logout();
    document.getElementById('userDropdown').classList.remove('show');
    resetUI();
}

function upgradeAccount() {
    // Simulate account upgrade
    if (appState.user && appState.user.plan === 'Free') {
        appState.user.plan = 'Pro';
        localStorage.setItem('pdfsmaller_user', JSON.stringify(appState.user));
        auth.updateUI();
        showNotification('Congratulations! You now have Pro features!', 'success');
    }
    document.getElementById('userDropdown').classList.remove('show');
}

function resetUI() {
    // Reset single file UI
    document.getElementById('singleFileInfo').style.display = 'none';
    document.getElementById('singleResults').style.display = 'none';
    document.getElementById('singleProgress').style.display = 'none';
    document.getElementById('singleCompressBtn').disabled = true;
    document.getElementById('singleFileInput').value = '';
    
    // Reset bulk UI
    document.getElementById('bulkFileList').innerHTML = '';
    document.getElementById('bulkFileList').style.display = 'none';
    document.getElementById('bulkResults').style.display = 'none';
    document.getElementById('bulkProgress').style.display = 'none';
    document.getElementById('bulkCompressBtn').disabled = true;
    document.getElementById('bulkFileInput').value = '';
    
    appState.reset();
}

// File Handling Functions
function handleSingleFile(file) {
    if (file.type !== 'application/pdf') {
        showNotification('Please select a valid PDF file.', 'error');
        return;
    }

    if (file.size > 50 * 1024 * 1024) { // 50MB limit
        showNotification('File size must be less than 50MB.', 'error');
        return;
    }

    appState.singleFile = file;
    document.getElementById('singleFileName').textContent = file.name;
    document.getElementById('singleFileSize').textContent = formatFileSize(file.size);
    document.getElementById('singleFileInfo').style.display = 'flex';
    document.getElementById('singleCompressBtn').disabled = false;
    
    // Hide previous results
    document.getElementById('singleResults').style.display = 'none';
}

function handleBulkFiles(files) {
    if (!auth.isPro()) {
        showNotification('Please upgrade to Pro to use bulk processing', 'error');
        return;
    }
    
    const validFiles = Array.from(files).filter(file => {
        if (file.type !== 'application/pdf') {
            showNotification(`Skipped ${file.name}: Not a PDF file`, 'warning');
            return false;
        }
        
        if (file.size > 10 * 1024 * 1024) { // 10MB limit for bulk
            showNotification(`Skipped ${file.name}: File exceeds 10MB limit`, 'warning');
            return false;
        }
        
        return true;
    });
    
    // Add to existing files, avoiding duplicates
    validFiles.forEach(file => {
        const exists = appState.bulkFiles.some(f => f.name === file.name && f.size === file.size);
        if (!exists) {
            appState.bulkFiles.push(file);
        }
    });
    
    updateBulkFileList();
}

function updateBulkFileList() {
    const fileList = document.getElementById('bulkFileList');
    fileList.innerHTML = '';
    
    if (appState.bulkFiles.length === 0) {
        fileList.style.display = 'none';
        document.getElementById('bulkCompressBtn').disabled = true;
        return;
    }
    
    fileList.style.display = 'block';
    document.getElementById('bulkCompressBtn').disabled = false;
    
    appState.bulkFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'bulk-file-item';
        fileItem.innerHTML = `
            <div class="file-info">
                <svg class="file-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="25" y="25" width="50" height="50" rx="5" fill="#3182ce"/>
                    <path d="M35 40H65V45H35z M35 50H65V55H35z M35 60H65V65H35z" fill="white"/>
                </svg>
                <div class="file-details">
                    <h4>${file.name}</h4>
                    <p>${formatFileSize(file.size)}</p>
                </div>
            </div>
            <button class="remove-file-btn" onclick="removeBulkFile(${index})">Remove</button>
        `;
        fileList.appendChild(fileItem);
    });
}

function removeBulkFile(index) {
    appState.bulkFiles.splice(index, 1);
    updateBulkFileList();
}

// Initialize Application
const appState = new AppState();
const auth = new AuthenticationManager(appState);
const compressor = new PDFCompressor(appState);

// Event Listeners Setup
document.addEventListener('DOMContentLoaded', function() {
    // Single file upload area
    const singleUploadArea = document.getElementById('singleUploadArea');
    const singleFileInput = document.getElementById('singleFileInput');
    
    singleUploadArea.addEventListener('click', () => singleFileInput.click());
    singleUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        singleUploadArea.classList.add('dragover');
    });
    singleUploadArea.addEventListener('dragleave', () => {
        singleUploadArea.classList.remove('dragover');
    });
    singleUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        singleUploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
            handleSingleFile(e.dataTransfer.files[0]);
        }
    });
    singleFileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleSingleFile(e.target.files[0]);
        }
    });

    // Bulk file upload area
    const bulkUploadArea = document.getElementById('bulkUploadArea');
    const bulkFileInput = document.getElementById('bulkFileInput');
    
    if (bulkUploadArea) {
        bulkUploadArea.addEventListener('click', () => {
            if (auth.isPro()) bulkFileInput.click();
        });
        bulkUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (auth.isPro()) bulkUploadArea.classList.add('dragover');
        });
        bulkUploadArea.addEventListener('dragleave', () => {
            bulkUploadArea.classList.remove('dragover');
        });
        bulkUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            bulkUploadArea.classList.remove('dragover');
            handleBulkFiles(e.dataTransfer.files);
        });
        bulkFileInput.addEventListener('change', (e) => {
            handleBulkFiles(e.target.files);
        });
    }

    // Quality sliders
    document.getElementById('singleImageQuality').addEventListener('input', (e) => {
        document.getElementById('singleQualityValue').textContent = e.target.value + '%';
    });
    
    document.getElementById('bulkImageQuality').addEventListener('input', (e) => {
        document.getElementById('bulkQualityValue').textContent = e.target.value + '%';
    });

    // Server processing checkbox
    document.getElementById('useServerProcessing').addEventListener('change', (e) => {
        const info = document.getElementById('serverProcessingInfo');
        if (e.target.checked && !auth.isPro()) {
            e.target.checked = false;
            showNotification('Server processing requires Pro subscription', 'error');
        } else {
            info.classList.toggle('show', e.target.checked);
        }
    });

    // Auth form
    document.getElementById('authForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        const name = document.getElementById('authName').value;
        const isLogin = document.getElementById('authModalTitle').textContent === 'Sign In';
        
        try {
            if (isLogin) {
                await auth.login(email, password);
                showNotification('Successfully signed in!', 'success');
            } else {
                await auth.register(email, password, name);
                showNotification('Account created successfully!', 'success');
            }
            hideAuthModal();
        } catch (error) {
            showNotification(error.message, 'error');
        }
    });

    // Compression buttons
    document.getElementById('singleCompressBtn').addEventListener('click', async () => {
        if (!appState.singleFile) return;
        
        const options = {
            compressionLevel: document.getElementById('singleCompressionLevel').value,
            imageQuality: parseInt(document.getElementById('singleImageQuality').value),
            useServer: document.getElementById('useServerProcessing').checked
        };

        try {
            appState.isProcessing = true;
            document.getElementById('singleCompressBtn').disabled = true;
            document.getElementById('singleCompressBtn').classList.add('processing');
            
            const result = await compressor.compressSingle(appState.singleFile, options);
            
            // Store compressed blob
            appState.compressedBlob = result.blob;
            
            // Calculate and display results
            const reductionPercent = ((result.originalSize - result.compressedSize) / result.originalSize * 100).toFixed(1);
            
            document.getElementById('singleOriginalSize').textContent = formatFileSize(result.originalSize);
            document.getElementById('singleCompressedSize').textContent = formatFileSize(result.compressedSize);
            document.getElementById('singleReductionPercent').textContent = `${reductionPercent}%`;
            document.getElementById('singleProcessingTime').textContent = `${result.processingTime.toFixed(1)}s`;
            
            // Show results
            document.getElementById('singleResults').style.display = 'block';
            
            showNotification('PDF compressed successfully!', 'success');
            
        } catch (error) {
            showNotification(error.message, 'error');
        } finally {
            appState.isProcessing = false;
            document.getElementById('singleCompressBtn').disabled = false;
            document.getElementById('singleCompressBtn').classList.remove('processing');
        }
    });

    // Download button
    document.getElementById('singleDownloadBtn').addEventListener('click', () => {
        if (appState.compressedBlob) {
            const url = URL.createObjectURL(appState.compressedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `compressed_${appState.singleFile.name}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }
    });

    // New file button
    document.getElementById('singleNewFileBtn').addEventListener('click', () => {
        resetUI();
    });

    // Bulk compression button
    document.getElementById('bulkCompressBtn').addEventListener('click', async () => {
        if (appState.bulkFiles.length === 0) return;
        
        const options = {
            compressionLevel: document.getElementById('bulkCompressionLevel').value,
            imageQuality: parseInt(document.getElementById('bulkImageQuality').value)
        };

        try {
            appState.isProcessing = true;
            document.getElementById('bulkCompressBtn').disabled = true;
            document.getElementById('bulkCompressBtn').classList.add('processing');
            
            const result = await compressor.compressBulk(appState.bulkFiles, options);
            
            // Store compressed files
            appState.bulkCompressedFiles = result.files;
            
            // Calculate and display results
            const totalOriginalSize = result.files.reduce((sum, file) => sum + file.originalSize, 0);
            const totalCompressedSize = result.files.reduce((sum, file) => sum + file.compressedSize, 0);
            const totalSavings = totalOriginalSize - totalCompressedSize;
            const averageReduction = ((totalSavings / totalOriginalSize) * 100).toFixed(1);
            
            document.getElementById('bulkTotalFiles').textContent = result.files.length;
            document.getElementById('bulkTotalSavings').textContent = formatFileSize(totalSavings);
            document.getElementById('bulkAverageReduction').textContent = `${averageReduction}%`;
            document.getElementById('bulkTotalTime').textContent = `${result.totalProcessingTime.toFixed(1)}s`;
            
            // Show results
            document.getElementById('bulkResults').style.display = 'block';
            
            showNotification(`Compressed ${result.files.length} files successfully!`, 'success');
            
        } catch (error) {
            showNotification(error.message, 'error');
        } finally {
            appState.isProcessing = false;
            document.getElementById('bulkCompressBtn').disabled = false;
            document.getElementById('bulkCompressBtn').classList.remove('processing');
        }
    });

    // Bulk download button
    document.getElementById('bulkDownloadBtn').addEventListener('click', async () => {
        if (appState.bulkCompressedFiles.length === 0) return;
        
        try {
            showNotification('Preparing download...', 'info');
            
            // In a real implementation, this would download a ZIP from the server
            // For demo purposes, we'll download files individually
            for (const file of appState.bulkCompressedFiles) {
                const url = URL.createObjectURL(file.blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `compressed_${file.originalName}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                // Small delay between downloads
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            showNotification('Downloads started!', 'success');
        } catch (error) {
            showNotification('Error preparing download', 'error');
        }
    });

    // New batch button
    document.getElementById('bulkNewBatchBtn').addEventListener('click', () => {
        resetUI();
    });

    // Close modals when clicking outside
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            hideAuthModal();
        }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.user-menu')) {
            document.getElementById('userDropdown').classList.remove('show');
        }
    });

    // Handle keyboard events
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            hideAuthModal();
            document.getElementById('userDropdown').classList.remove('show');
        }
    });
});

// Backend API Integration
class BackendAPI {
    constructor() {
        this.baseURL = 'https://api.pdfsmaller.site';
        this.token = localStorage.getItem('pdfsmaller_token');
    }

    setToken(token) {
        this.token = token;
        localStorage.setItem('pdfsmaller_token', token);
    }

    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
            ...options.headers
        };

        if (this.token) {
            headers['Authorization'] = `Bearer ${this.token}`;
        }

        try {
            const response = await fetch(url, {
                ...options,
                headers
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'API request failed');
            }

            return await response.json();
        } catch (error) {
            console.error('API request failed:', error);
            throw error;
        }
    }

    // Authentication endpoints
    async login(email, password) {
        const response = await this.request('/api/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password })
        });
        
        if (response.token) {
            this.setToken(response.token);
        }
        
        return response;
    }

    async register(name, email, password) {
        const response = await this.request('/api/auth/register', {
            method: 'POST',
            body: JSON.stringify({ name, email, password })
        });
        
        if (response.token) {
            this.setToken(response.token);
        }
        
        return response;
    }

    async getProfile() {
        return await this.request('/api/auth/profile');
    }

    // Compression endpoints
    async compressSingle(file, options) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('compressionLevel', options.compressionLevel);
        formData.append('imageQuality', options.imageQuality);

        const response = await fetch(`${this.baseURL}/api/compress/single`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${this.token}`
            },
            body: formData
        });

        if (!response.ok) {
            throw new Error('Compression failed');
        }

        return await response.blob();
    }

    async compressBulk(files, options) {
        const formData = new FormData();
        
        files.forEach((file, index) => {
            formData.append(`file${index}`, file);
        });
        
        formData.append('compressionLevel', options.compressionLevel);
        formData.append('imageQuality', options.imageQuality);

        const response = await fetch(`${this.baseURL}/api/compress/bulk`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${this.token}`
            },
            body: formData
        });

        if (!response.ok) {
            throw new Error('Bulk compression failed');
        }

        return await response.blob();
    }

    // Payment endpoints
    async createSubscription(plan, paymentMethod) {
        return await this.request('/api/payment/subscribe', {
            method: 'POST',
            body: JSON.stringify({ plan, paymentMethod })
        });
    }

    async getSubscription() {
        return await this.request('/api/payment/subscription');
    }

    async cancelSubscription() {
        return await this.request('/api/payment/cancel', {
            method: 'POST'
        });
    }
}


// Update the BackendAPI class with subscription methods
BackendAPI.prototype.createSubscription = async function(planId, paymentMethodId) {
    return await this.request('/api/subscriptions/create', {
        method: 'POST',
        body: JSON.stringify({ planId, paymentMethodId })
    });
};

BackendAPI.prototype.cancelSubscription = async function() {
    return await this.request('/api/subscriptions/cancel', {
        method: 'POST'
    });
};

BackendAPI.prototype.getSubscription = async function() {
    return await this.request('/api/subscriptions');
};

// Initialize backend API
const backendAPI = new BackendAPI();


// Update AuthenticationManager to use real backend
AuthenticationManager.prototype.login = async function(email, password) {
    try {
        const response = await backendAPI.login(email, password);
        const user = {
            id: response.user.id,
            name: response.user.name,
            email: response.user.email,
            plan: response.user.plan
        };
        this.setUser(user);
        return user;
    } catch (error) {
        throw new Error(error.message || 'Login failed');
    }
};

AuthenticationManager.prototype.register = async function(email, password, name) {
    try {
        const response = await backendAPI.register(name, email, password);
        const user = {
            id: response.user.id,
            name: response.user.name,
            email: response.user.email,
            plan: response.user.plan
        };
        this.setUser(user);
        return user;
    } catch (error) {
        throw new Error(error.message || 'Registration failed');
    }
};

// Update AuthenticationManager to handle plan information
AuthenticationManager.prototype.updateUI = function() {
    const guestActions = document.getElementById('guestActions');
    const userActions = document.getElementById('userActions');
    const bulkUpgradePrompt = document.getElementById('bulkUpgradePrompt');
    const bulkProcessingArea = document.getElementById('bulkProcessingArea');
    const useServerCheckbox = document.getElementById('useServerProcessing');

    if (this.appState.user) {
        guestActions.classList.add('hidden');
        userActions.classList.remove('hidden');
        
        document.getElementById('userInitials').textContent = 
            this.appState.user.name.charAt(0).toUpperCase();
        document.getElementById('userName').textContent = this.appState.user.name;
        document.getElementById('userPlan').textContent = this.appState.user.plan;

        // Enable/disable features based on plan
        if (this.appState.user.plan.includes('Pro')) {
            bulkUpgradePrompt.classList.add('hidden');
            bulkProcessingArea.classList.remove('hidden');
            useServerCheckbox.disabled = false;
        } else {
            bulkUpgradePrompt.classList.remove('hidden');
            bulkProcessingArea.classList.add('hidden');
            useServerCheckbox.disabled = true;
        }
        
        // Update pricing UI if on pricing tab
        if (appState.currentTab === 'pricing') {
            updatePricingUI();
        }
    } else {
        guestActions.classList.remove('hidden');
        userActions.classList.add('hidden');
        bulkUpgradePrompt.classList.remove('hidden');
        bulkProcessingArea.classList.add('hidden');
        useServerCheckbox.disabled = true;
        
        // Update pricing UI if on pricing tab
        if (appState.currentTab === 'pricing') {
            updatePricingUI();
        }
    }
};

// Update PDFCompressor to use real backend
PDFCompressor.prototype.compressOnServer = async function(file, options) {
    return await backendAPI.compressSingle(file, options);
};

PDFCompressor.prototype.compressBulk = async function(files, options) {
    const blob = await backendAPI.compressBulk(files, options);
    
    // In a real implementation, the server would return a ZIP file
    // For now, we'll return individual file results
    return {
        files: files.map(file => ({
            originalName: file.name,
            originalSize: file.size,
            compressedSize: Math.floor(file.size * 0.6), // Simulate 40% reduction
            blob: file // In real implementation, this would be the compressed file
        })),
        totalProcessingTime: files.length * 2 // Simulate processing time
    };
};

// Add payment functionality
async function upgradeToPro() {
    if (!appState.user) {
        showAuthModal('register');
        return;
    }

    try {
        showNotification('Redirecting to payment...', 'info');
        
        // In a real implementation, this would integrate with Stripe or similar
        // For demo purposes, we'll simulate successful payment
        setTimeout(() => {
            appState.user.plan = 'Pro';
            localStorage.setItem('pdfsmaller_user', JSON.stringify(appState.user));
            auth.updateUI();
            showNotification('Successfully upgraded to Pro!', 'success');
        }, 2000);
    } catch (error) {
        showNotification('Payment failed: ' + error.message, 'error');
    }
}

// Add service worker for offline functionality (if needed)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(error => {
            console.log('ServiceWorker registration failed:', error);
        });
    });
}

// Export functions for global access
window.switchTab = switchTab;
window.showAuthModal = showAuthModal;
window.hideAuthModal = hideAuthModal;
window.toggleAuthMode = toggleAuthMode;
window.toggleUserDropdown = toggleUserDropdown;
window.logout = logout;
window.upgradeAccount = upgradeAccount;
window.removeBulkFile = removeBulkFile;
window.upgradeToPro = upgradeToPro;
window.handlePlanSelection = handlePlanSelection;
window.downgradeToFree = downgradeToFree;

</script>
</body>
</html>

